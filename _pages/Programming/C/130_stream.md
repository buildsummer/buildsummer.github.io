---
title: 스트림
date: 2025-02-05 140000
---
---
# 파일 입출력
* stdio.h : FILE 형
* 스트림
  * 프로그램과 각 하드웨어를 연결해주는 파이프
  * 운영체제가 스스로 하는 부분
  * 표준스트림(다른 스트림이 생성될 때 자동생성)
    * 모니터에 대한 스트림 : stdout, stderr
    * 키보드에 대한 스트림 : stdin
* fopen(파일명, [타입])
  * 파일과 관련된 스트림을 만들어줌
  * 못 열면 NULL 리턴
  * 타입
    * 없으면 그냥 열기
    * w : 생성 또는 덮어쓰기
    * r : 읽기
    * a : append, 맨 끝부터 쓰기
    * w+, r+, a+ : 각 기능을 베이스 열고, 연 후에는 읽기 쓰기 둘다 가능
* fputs(스트링, 포인터)
  * 쓰기
  * 꼭 파일의 포인터일 필요는 없음
  * stdout을 전달하면 그냥 콘솔에 출력됨

* fclose(포인터)
  * 스트림 닫기
  * 표준스트림도 닫을 수 있음
  * stdout 닫으면 이후 printf해도 아무것도 안 뜸

* fgets(버퍼, 바이트수, 포인터);
  * min(바이트, 개행문자위치) 만큼 버퍼에 읽어옴
  * 바이트에는 널스트링 포함해야 함

* fgetc(포인터): 한 글자씩 읽어옴
* fread
* EOF
  * (-1)
  * 파일의 맨 마지막임을 의미
* fprintf
  * printf는 stdout에만 가능
  * fprintf는 임의 스트림에서 가능

* fscanf(스트림, 형식, 변수);
  * 임의 스트림에서 가능
 
```c
int main() {
    FILE *fp;
    fp = fopen("a.txt", "w");

    if (fp == NULL) {
        printf("Write Error!!\n");
        return 0;
    }

    fputs("Hello World \n", fp);
    fclose(fp);
}
```
```text
Hello World 
```

```c
int main() {
    FILE *fp;
    char buf[20];
    char c;
    fp = fopen("a.txt", "r");

    if (fp == NULL) {
        printf("Read Error!!\n");
        return 0;
    }

    fgets(buf, 5, fp);
    printf("내용 : %s \n", buf);

    while ((c = fgetc(fp)) != EOF) {
        printf("%c", c);
    }
    fclose(fp);
}
```
```text
내용 : Hell 
o World 
```

---
# 파일 위치 지정자
* 파일에서 다음에 입력받아야 할 위치를 가리키고 있음
  * fgetc를 세 번 실행했으면 4번째 글자를 가리킴

* fseek(포인터, 거리, 위치)
  * 파일 위치 지정자(파일에서 어디까지 읽었는지)를 바꾸는 함수
  * 위치에서 거리만큼 움직여서 바꿈
    * +면 오른쪽, -면 왼쪽
  * 다시 파일을 처음부터 읽고 싶으면 파일을 다시 열거나 위치 지정자를 바꿔주면 됨
  * fseek(fp, 0, SEEK_SET)
    * SEEK_SET : 파일 열었을 때 지정자 위치
    * SEEK_CUR : 현재 파일위치 지정자 위치
    * SEEK_END : 마지막 위치, EOF를 가리킴

* 읽기 뿐만 아니라 쓰기도 됨
  * 쓰기는 그 위치에서 덮어써버리기 때문에 조심할 것

* 단, 쓰기/읽기 모드 전환 시
  * fflush, fseek 함수를 무조건 호출하여 파일 위지 지정자를 다시 설정해주어야 함
  * fflush(포인터); : 버퍼의 내용을 파일에 적용함
  * fseek(fp, 0, SEEK_CUR); : 단순 호출(위치지정자 명시 목적)

* 버퍼링
  * 쓰거나 읽을 때 바로바로 물리 데이터와 상호작용 하는 게 아니라, 메모리에 버퍼를 만들어두고 버퍼와 상호작용
  * 읽기 버퍼와 쓰기버퍼가 따로 존재하는데 파일 위치지정자는 스트림에서 하나만 쓰기 때문에 문제가 발생할 수 있음
  * 쓰기를 수행하면 바로 파일에 써지는 게 아니로 메모리의 버퍼에만 작업을 해놓는데, 이 상태에서 읽기를 수행하면 바뀌지 않은 파일의 데이터를 읽어버림
